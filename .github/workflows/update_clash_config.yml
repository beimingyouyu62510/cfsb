name: è‡ªåŠ¨æ›´æ–° Clash èŠ‚ç‚¹é…ç½®

on:
  push:
    branches:
      - main # æ›¿æ¢ä¸ºæ‚¨ä»“åº“çš„ä¸»åˆ†æ”¯åç§°ï¼Œä¾‹å¦‚ main æˆ– master
  schedule:
    # æ¯å¤© UTC æ—¶é—´ 00:30 è¿è¡Œä¸€æ¬¡ (å³åŒ—äº¬æ—¶é—´ 08:30)
    - cron: '30 0 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  update-config:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»“åº“ä»£ç 
        uses: actions/checkout@v4
        
      - name: ğŸ è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
          
      - name: ğŸ“¦ å®‰è£…ä¾èµ–åº“
        run: pip install pyyaml requests
        
      - name: âš™ï¸ æ‰§è¡Œé…ç½®æ›´æ–°è„šæœ¬
        run: python update_config.py
        
      - name: ğŸ’¾ æ£€æŸ¥æ–‡ä»¶å˜æ›´å¹¶æäº¤
        run: |
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'
          
          # æ£€æŸ¥ free.yaml æ˜¯å¦æœ‰å˜åŒ–
          if git diff --exit-code free.yaml; then
            echo "::notice file=free.yaml::free.yaml æ–‡ä»¶æ²¡æœ‰å˜åŒ–ï¼Œæ— éœ€æäº¤ã€‚"
          else
            echo "::notice file=free.yaml::free.yaml æ–‡ä»¶å·²æ›´æ–°ï¼Œæ­£åœ¨æäº¤ã€‚"
            git add free.yaml
            git commit -m "ğŸ¤– Chore: è‡ªåŠ¨æ›´æ–° Clash èŠ‚ç‚¹ä¿¡æ¯ (by GitHub Actions)"
            git push
          fi
