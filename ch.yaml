allow-lan: true
unified-delay: false
tcp-concurrent: true
find-process-mode: strict
global-client-fingerprint: chrome
profile:
  store-selected: true
  store-fake-ip: true
sniffer:
  enable: true
  sniff:
    HTTP:
      ports:
        - 80
        - 8080-8880
      override-destination: true
    TLS:
      ports:
        - 443
        - 8443
    QUIC:
      ports:
        - 443
        - 8443
  skip-domain:
    - Mijia Cloud
    - dlg.io.mi.com
    - +.push.apple.com
tun:
  enable: true
  stack: system
  device: mihomo
  dns-hijack:
    - any:53
    - tcp://any:53
  auto-route: true
  auto-detect-interface: true
  strict-route: true
  endpoint-independent-nat: true
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: false
  prefer-h3: true
  respect-rules: true
  enhanced-mode: fake-ip
  use-hosts: true
  default-nameserver:
    - 223.5.5.5
    - 180.168.255.18
    - 117.50.11.11
  nameserver:
    - https://dns.google/dns-query
    - https://1.1.1.1/dns-query
  proxy-server-nameserver:
    - 223.5.5.5
    - https://dns.alidns.com/dns-query
    - 119.29.29.29
    - https://doh.pub/dns-query
  nameserver-policy:
    "geosite:cn,apple-cn,category-games@cn,private":
      - 117.50.11.11
      - 180.168.255.18
      - 223.5.5.5
  fake-ip-range: 28.0.0.1/8
  fake-ip-filter:
    - '*'
    - +.lan
    - +.local
    - +.stun.*.*
    - +.stun.*.*.*
    - +.stun.*.*.*.*
    - +.stun.*.*.*.*.*
geodata-mode: true
geox-url:
  geoip: https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geoip.dat
  geosite: https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geosite.dat
proxies:
  # 注意：这部分内容在首次手动创建或克隆仓库时可能为空或包含旧节点。
  # 每次 GitHub Actions 运行 update_nodes.py 脚本后，
  # 这里的列表都会被远程订阅源中最新的 VLESS+WS 节点完全替换。
  - name: Hong Kong 0
    server: 104.17.194.213
    port: 80
    type: vless
    uuid: cdc1d7d3-fe56-4a38-a724-21308e4393d9
    tls: false
    network: ws
    ws-opts:
      path: /?ed=2048
      headers:
        Host: empty-rain-1b4a.hebe061103.workers.dev
  - name: Hong Kong 1
    server: 104.17.194.220
    port: 80
    type: vless
    uuid: 3d2176d3-89b8-40aa-b004-0ff837bed25c
    tls: false
    network: ws
    ws-opts:
      path: /?ed=2048
      headers:
        Host: gentle-grass-cf96.hebe061103.workers.dev
  - name: Hong Kong 2
    server: 104.17.194.239
    port: 80
    type: vless
    uuid: 3962565d-e47d-4dd0-aa19-3286e04d9cb6
    tls: false
    network: ws
    ws-opts:
      path: /?ed=2048
      headers:
        Host: nameless-resonance-6e4c.hebe061103.workers.dev
  - name: Hong Kong 3
    server: 104.17.194.249
    port: 80
    type: vless
    uuid: 4239d44c-19c7-4b8b-ae07-16607c95b6fb
    tls: false
    network: ws
    ws-opts:
      path: /?ed=2048
      headers:
        Host: gentle-night-12e3.hebe061103.workers.dev
  - name: Hong Kong 4
    server: 104.17.194.1
    port: 80
    type: vless
    uuid: 2e632913-bae0-4855-893c-02c828c835a2
    tls: false
    network: ws
    ws-opts:
      path: /?ed=2048
      headers:
        Host: 56e5.hebe061103.workers.dev
proxy-groups:
  # 核心负载均衡组：所有从远程订阅获取的 VLESS+WS 节点都汇集于此。
  # 这个组由 update_nodes.py 脚本全自动更新。
  # 所有需要代理的流量都将导向此组，由其根据 consistent-hashing 策略进行分发。
  - name: 🚀 负载均衡
    type: load-balance
    url: http://www.google.com/generate_204
    interval: 300
    strategy: consistent-hashing
    proxies:
      # 脚本会自动更新这里的列表，替换为最新的 Hong Kong X 节点
      - Hong Kong 0
      - Hong Kong 1
      - Hong Kong 2
      - Hong Kong 3
      - Hong Kong 4

  # 全球直连组：用于强制直连的规则。
  - name: 🎯 全球直连
    type: select
    proxies:
      - DIRECT

  # 应用净化/广告拦截组：用于强制拒绝或拦截的规则。
  - name: 🍃 应用净化
    type: select
    proxies:
      - REJECT

rule-providers:
  Anti-Ads:
    type: http
    behavior: domain
    format: yaml
    path: ./rule_provider/Anti-Ads.yaml
    url: https://anti-ad.net/clash.yaml
    interval: 43200 # 12小时更新一次
    lazy: false
rules:
  ## 非 IP 类规则 - 更精确的匹配优先
  ### 广告和恶意域名拦截 (使用 Rule Provider) - 放在非常靠前的位置以提高拦截效率
  - RULE-SET,Anti-Ads,🍃 应用净化 # 导向新的“应用净化”组

  ### 自定义直连（常用国内服务，确保优先直连）
  - DOMAIN-SUFFIX,taobao.com,🎯 全球直连
  - DOMAIN-SUFFIX,tmall.com,🎯 全球直连
  - DOMAIN-SUFFIX,alibaba.com,🎯 全球直连
  - DOMAIN-SUFFIX,alipay.com,🎯 全球直连
  - DOMAIN-SUFFIX,aliyun.com,🎯 全球直连
  - DOMAIN-KEYWORD,taobao,🎯 全球直连
  - DOMAIN-KEYWORD,tmall,🎯 全球直连
  - DOMAIN,v.ddys.pro,🎯 全球直连
  - DOMAIN,ddys.pro,🎯 全球直连
  - DOMAIN-KEYWORD,easytier,🎯 全球直连

  ### 特定代理需求（特定域名强制走代理）
  - DOMAIN-SUFFIX,hf.co,🚀 负载均衡
  - DOMAIN-SUFFIX,r2.cloudflarestorage.com,🚀 负载均衡

  ### QUIC/UDP 流量处理 (谨慎调整，如果遇到 QUIC 服务异常，可能需要移除此条)
  # 如果要保留，将其指向 🚀 负载均衡，而不是 REJECT
  # - AND,(AND,(DST-PORT,443),(NETWORK,UDP)),(NOT,((GEOSITE,cn))),🚀 负载均衡 

  ### GEOSITE 规则 - 国内服务优先直连，国外服务走代理
  - GEOSITE,category-games@cn,🎯 全球直连 # 国内游戏直连，确保低延迟
  - GEOSITE,cn,🎯 全球直连 # 所有中国大陆域名直连
  - GEOSITE,apple-cn,🎯 全球直连 # 苹果中国服务直连
  - GEOSITE,microsoft,🎯 全球直连 # 微软服务，默认直连，根据需要可调整为负载均衡
  - GEOSITE,apple,🚀 负载均衡 # 苹果国际服务走负载均衡
  - GEOSITE,google,🚀 负载均衡 # Google 服务走负载均衡
  - GEOSITE,telegram,🚀 负载均衡 # Telegram 走负载均衡
  - GEOSITE,category-entertainment,🚀 负载均衡 # 流媒体和娱乐走负载均衡
  - GEOSITE,category-social-media-!cn,🚀 负载均衡 # 国外社交媒体走负载均衡
  - GEOSITE,category-android-app-download,🚀 负载均衡 # 安卓应用下载走负载均衡
  - GEOSITE,category-porn,🚀 负载均衡 # 敏感内容走负载均衡
  - GEOSITE,onedrive,🚀 负载均衡 # OneDrive 走负载均衡
  - GEOSITE,category-ai-chat-!cn,🚀 负载均衡 # AI聊天走负载均衡
  - GEOSITE,category-cryptocurrency,🚀 负载均衡 # 加密货币走负载均衡
  - GEOSITE,geolocation-!cn,🚀 负载均衡 # 所有非中国地理位置的域名（兜底代理）

  ## IP 类规则 - 精确匹配优先
  ### 绕过局域网和特殊保留地址 (优先直连)
  - IP-CIDR,10.0.0.0/8,🎯 全球直连
  - IP-CIDR,172.16.0.0/12,🎯 全球直连
  - IP-CIDR,192.168.0.0/16,🎯 全球直连
  - IP-CIDR,100.64.0.0/10,🎯 全球直连
  - IP-CIDR,127.0.0.0/8,🎯 全球直连
  - IP-CIDR,::1/128,🎯 全球直连       # IPv6 localhost
  - IP-CIDR,fc00::/7,🎯 全球直连      # IPv6 Unique Local Address
  - IP-CIDR,fe80::/10,🎯 全球直连     # IPv6 Link-Local Address

  ### GEOIP 规则 - 国内 IP 直连，国外 IP 走代理
  - GEOIP,CN,🎯 全球直连,no-resolve # 中国大陆 IP 直连
  - GEOIP,google,🚀 负载均衡,no-resolve # Google IP 走负载均衡
  - GEOIP,telegram,🚀 负载均衡,no-resolve # Telegram IP 走负载均衡
  - GEOIP,facebook,🚀 负载均衡,no-resolve # Facebook IP 走负载均衡
  - GEOIP,twitter,🚀 负载均衡,no-resolve # Twitter IP 走负载均衡
  - GEOIP,netflix,🚀 负载均衡,no-resolve # Netflix IP 走负载均衡

  ## 兜底规则 - 最后匹配
  - MATCH,🚀 负载均衡 # 任何未匹配的流量都交给 "🚀 负载均衡" 处理
